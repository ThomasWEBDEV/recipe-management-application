<div class="row">
  <div class="col-md-8">
    <div class="card-trip">
      <%= image_tag "https://picsum.photos/seed/#{@recipe.id}/800/400", class: "w-100" %>
      <div class="card-trip-infos">
        <div>
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h2><%= @recipe.title %></h2>
            <%= render 'shared/favorite_button', recipe: @recipe %>
          </div>
          <p><%= @recipe.description %></p>
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <span class="badge bg-primary me-2"><%= @recipe.category %></span>
              <div class="d-flex align-items-center text-muted">
                <%= user_avatar(@recipe.user, size: 24) %>
                <small class="ms-2">Par <%= @recipe.user.email.split('@').first.capitalize %></small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Badges informatifs -->
    <div class="d-flex gap-2 flex-wrap my-3">
      <% if @recipe.difficulty.present? %>
        <% difficulty_color = { 'facile' => 'success', 'moyen' => 'warning', 'difficile' => 'danger' }[@recipe.difficulty] %>
        <span class="badge bg-<%= difficulty_color %>">
          <% if @recipe.difficulty == 'facile' %>
            <i class="fas fa-smile"></i> Facile
          <% elsif @recipe.difficulty == 'moyen' %>
            <i class="fas fa-meh"></i> Moyen
          <% else %>
            <i class="fas fa-tired"></i> Difficile
          <% end %>
        </span>
      <% end %>

      <% if @recipe.prep_time.present? %>
        <span class="badge bg-info text-dark">
          <i class="fas fa-clock"></i> Préparation : <%= @recipe.prep_time %> min
        </span>
      <% end %>

      <% if @recipe.cook_time.present? %>
        <span class="badge bg-warning text-dark">
          <i class="fas fa-fire"></i> Cuisson : <%= @recipe.cook_time %> min
        </span>
      <% end %>

      <% if @recipe.prep_time.present? && @recipe.cook_time.present? %>
        <span class="badge bg-success">
          <i class="fas fa-utensils"></i> Total : <%= @recipe.prep_time + @recipe.cook_time %> min
        </span>
      <% end %>
    </div>

    <!-- Actions utilisateur -->
    <% if @recipe.user == current_user %>
      <div class="d-flex gap-2 mt-3">
        <%= link_to "Modifier", edit_recipe_path(@recipe), class: "btn btn-ghost" %>
        <%= button_to "Supprimer", @recipe, method: :delete, data: { turbo_confirm: "Êtes-vous sûr ?" }, class: "btn btn-danger" %>
      </div>
    <% end %>
  </div>

  <div class="col-md-4">
    <h3>Ingrédients</h3>
    <% if @recipe.user == current_user %>
      <%= link_to "Ajouter un ingrédient", new_recipe_ingredient_path(@recipe), class: "btn btn-gradient mb-3" %>
    <% end %>

    <% if @recipe.ingredients.any? %>
      <ul class="list-group">
        <% @recipe.ingredients.each do |ingredient| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span><strong><%= ingredient.name %></strong> - <%= ingredient.quantity %></span>
            <% if @recipe.user == current_user %>
              <%= button_to "×", recipe_ingredient_path(@recipe, ingredient), method: :delete, class: "btn btn-sm btn-danger", title: "Supprimer cet ingrédient" %>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-muted">Aucun ingrédient ajouté pour le moment.</p>
    <% end %>
  </div>
</div>
